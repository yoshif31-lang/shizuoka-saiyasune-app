<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é™å²¡æœ€å®‰å€¤ãƒŠãƒ“ | éŸ¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .chibi-hibiki { animation: breathe 3s ease-in-out infinite; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
        .bubble-float { animation: float 2.5s ease-in-out infinite; }
        @keyframes snowfall { 0% { transform: translateY(-10vh); opacity: 0.8; } 100% { transform: translateY(100vh); opacity: 0.2; } }
        .snowflake { position: absolute; background: white; border-radius: 50%; pointer-events: none; animation: snowfall linear infinite; }
    </style>
</head>
<body class="bg-[#f7faf8] text-slate-900 font-sans min-h-screen">
    <div id="snow-field" class="fixed inset-0 z-50 pointer-events-none" style="display:none;"></div>

    <nav id="header-nav" class="sticky top-0 z-40 backdrop-blur-md border-b shadow-sm py-4 transition-colors duration-700">
        <div class="max-w-md mx-auto px-4 text-center">
            <h1 id="header-title" class="text-lg font-black mb-3 tracking-tighter uppercase flex items-center justify-center gap-2 transition-colors duration-700">
                <span id="season-icon-l"></span>
                é™å²¡æœ€å®‰å€¤ãƒŠãƒ“
                <span id="season-icon-r"></span>
            </h1>
            <div id="tab-container" class="flex gap-2 overflow-x-auto no-scrollbar justify-between sm:justify-center">
                <button onclick="filterArea('æµœæ¾')" class="tab-btn flex-none px-4 py-2 rounded-full text-xs font-bold transition-all">æµœæ¾</button>
                <button onclick="filterArea('ç£ç”°')" class="tab-btn flex-none px-4 py-2 rounded-full text-xs font-bold transition-all">ç£ç”°</button>
                <button onclick="filterArea('è¢‹äº•')" class="tab-btn flex-none px-4 py-2 rounded-full text-xs font-bold transition-all">è¢‹äº•</button>
                <button onclick="filterArea('æ›å·')" class="tab-btn flex-none px-4 py-2 rounded-full text-xs font-bold transition-all">æ›å·</button>
                <button onclick="filterArea('ã™ã¹ã¦')" class="tab-btn flex-none px-4 py-2 rounded-full text-xs font-bold transition-all">ã™ã¹ã¦</button>
            </div>
        </div>
    </nav>

    <main class="max-w-md mx-auto px-4 py-6 space-y-4 pb-32">
        <div id="price-list" class="w-full space-y-4">
            <p class="text-center py-10 text-slate-400 text-xs">ãƒ‘ãƒˆãƒ­ãƒ¼ãƒ«ä¸­...</p>
        </div>
    </main>

    <div class="fixed bottom-6 right-6 z-50 flex flex-col items-center w-28">
        <div class="mb-2 relative bubble-float z-20">
            <div class="bg-white px-3 py-2 rounded-xl shadow-lg border border-emerald-50 text-center">
                <p id="chat-bubble" class="text-[9px] font-bold text-slate-700 leading-tight">ãƒã‚§ãƒƒã‚¯ã—ã‚ˆã†ï¼</p>
            </div>
            <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-white border-r border-b border-emerald-50 rotate-45"></div>
        </div>
        <div class="w-20 h-20 rounded-full bg-white border-4 border-white shadow-2xl overflow-hidden relative z-10 chibi-hibiki">
            <img id="hibiki-img" src="./1766939160101.png" alt="éŸ¿" class="w-full h-full object-cover object-top">
        </div>
    </div>

    <script>
        const CSV_URL = "./supermarket_prices.csv";
        let allData = [];
        let currentTheme = {};

        // ğŸ“… å­£ç¯€åˆ¤å®šã¨ãƒ†ãƒ¼ãƒè¨­å®š
        function applySeasonTheme() {
            const m = new Date().getMonth() + 1;
            const header = document.getElementById('header-nav');
            const title = document.getElementById('header-title');
            const iconL = document.getElementById('season-icon-l');
            const iconR = document.getElementById('season-icon-r');
            const snow = document.getElementById('snow-field');

            let theme = {
                name: 'default',
                bg: 'bg-white/95',
                border: 'border-emerald-100',
                text: 'text-emerald-800',
                icon: 'ğŸ›’',
                tabBg: 'bg-emerald-50',
                tabText: 'text-emerald-700',
                active: 'bg-emerald-600'
            };

            if (m === 12 || m <= 2) { // å†¬
                theme = { name: 'winter', bg: 'bg-blue-50/90', border: 'border-blue-200', text: 'text-blue-900', icon: 'â›„', tabBg: 'bg-blue-100', tabText: 'text-blue-800', active: 'bg-blue-600' };
                snow.style.display = "block";
            } else if (m >= 3 && m <= 5) { // æ˜¥
                theme = { name: 'spring', bg: 'bg-pink-50/90', border: 'border-pink-200', text: 'text-pink-900', icon: 'ğŸŒ¸', tabBg: 'bg-pink-100', tabText: 'text-pink-800', active: 'bg-pink-600' };
            } else if (m >= 6 && m <= 8) { // å¤
                theme = { name: 'summer', bg: 'bg-orange-50/90', border: 'border-orange-200', text: 'text-orange-900', icon: 'â˜€ï¸', tabBg: 'bg-orange-100', tabText: 'text-orange-800', active: 'bg-orange-600' };
            } else { // ç§‹
                theme = { name: 'autumn', bg: 'bg-amber-50/90', border: 'border-amber-200', text: 'text-amber-900', icon: 'ğŸ', tabBg: 'bg-amber-100', tabText: 'text-amber-800', active: 'bg-amber-600' };
            }

            currentTheme = theme;
            header.className = `sticky top-0 z-40 ${theme.bg} backdrop-blur-md border-b ${theme.border} shadow-sm py-4 transition-all duration-700`;
            title.className = `text-center text-lg font-black ${theme.text} mb-3 tracking-tighter uppercase flex items-center justify-center gap-2`;
            iconL.innerText = theme.icon;
            iconR.innerText = theme.icon;

            if (theme.name === 'winter') {
                for (let i = 0; i < 20; i++) {
                    const s = document.createElement('div');
                    s.className = 'snowflake';
                    s.style.left = Math.random() * 100 + '%';
                    const sz = Math.random() * 5 + 2 + 'px';
                    s.style.width = sz; s.style.height = sz;
                    s.style.animationDuration = Math.random() * 5 + 5 + 's';
                    s.style.animationDelay = Math.random() * 5 + 's';
                    snow.appendChild(s);
                }
            }
        }

        function setup() {
            applySeasonTheme();
            const now = new Date();
            const m = now.getMonth() + 1;
            const d = now.getDate();
            const img = document.getElementById('hibiki-img');
            const chat = document.getElementById('chat-bubble');

            let file = "1766939160101.png"; //
            let msg = "ãƒã‚§ãƒƒã‚¯ã—ã‚ˆã†ï¼";

            if (m === 1 && d <= 3) {
                file = "avatar_newyear.png"; //
                msg = "ã‚ã‘ãŠã‚ï¼";
            }

            img.src = "./" + file;
            chat.innerText = msg;
            img.onerror = () => { img.src = "./1766939160101.png"; };
        }

        async function loadData() {
            try {
                const response = await fetch(CSV_URL + "?v=" + Date.now());
                const text = await response.text();
                const lines = text.split('\n').filter(l => l.trim()).slice(1);
                allData = lines.map(line => line.split(','));
                render('ã™ã¹ã¦');
            } catch (e) {
                document.getElementById('price-list').innerHTML = '<div class="text-center py-10 text-slate-400 text-xs">ãƒ‘ãƒˆãƒ­ãƒ¼ãƒ«ä¸­...</div>';
            }
        }

        function render(area) {
            const list = document.getElementById('price-list');
            const filtered = area === 'ã™ã¹ã¦' ? allData : allData.filter(d => (d[2] || "").includes(area));
            
            if (filtered.length === 0) {
                list.innerHTML = `<div class="bg-white p-8 rounded-3xl text-center text-slate-400 text-xs shadow-sm">ç¾åœ¨ã€${area}ã®ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“</div>`;
            } else {
                list.innerHTML = filtered.map(c => `
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-emerald-50 flex justify-between items-center transition-transform active:scale-95">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 ${currentTheme.tabBg} rounded-xl flex items-center justify-center text-lg">ğŸ›’</div>
                            <div>
                                <h3 class="font-black text-slate-700 text-[11px] leading-none">${c[0]||"-"}</h3>
                                <p class="text-[9px] text-slate-400 font-bold mt-1">ğŸ“ ${c[2]||"-"}</p>
                            </div>
                        </div>
                        <div class="text-right font-black text-red-500 text-lg">Â¥${c[1]||"-"}</div>
                    </div>
                `).join('');
            }

            document.querySelectorAll('.tab-btn').forEach(btn => {
                if(btn.innerText === area) {
                    btn.className = `tab-btn flex-none px-4 py-2 rounded-full ${currentTheme.active} text-white text-xs font-bold transition-all shadow-md`;
                } else {
                    btn.className = `tab-btn flex-none px-4 py-2 rounded-full ${currentTheme.tabBg} ${currentTheme.tabText} text-xs font-bold transition-all`;
                }
            });
        }

        function filterArea(area) { render(area); }

        setup();
        loadData();
    </script>
</body>
</html>
