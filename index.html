<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é™å²¡æœ€å®‰å€¤ãƒŠãƒ“ | éŸ¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* éŸ¿ã®å…¨èº«ã‚’æ´»ã‹ã™å‘¼å¸ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
        .hibiki-hero { animation: breathe 4s ease-in-out infinite; transform-origin: bottom; }
        /* å­£ç¯€ã®é›ªæ¼”å‡º */
        @keyframes snowfall { 0% { transform: translateY(-10vh); opacity: 0.8; } 100% { transform: translateY(100vh); opacity: 0.2; } }
        .snowflake { position: absolute; background: white; border-radius: 50%; pointer-events: none; animation: snowfall linear infinite; }
        /* 12/30æ™‚ç‚¹ã®ç‰¹åˆ¥ãªå½±ã¨ã¼ã‹ã— */
        .glass-nav { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); }
    </style>
</head>
<body class="bg-[#f2f7f5] text-slate-900 font-sans min-h-screen pb-24">
    <div id="snow-field" class="fixed inset-0 z-50 pointer-events-none" style="display:none;"></div>

    <header class="sticky top-0 z-40 glass-nav border-b border-emerald-100 p-4">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-xl font-black text-emerald-800 tracking-tighter">é™å²¡æœ€å®‰å€¤ãƒŠãƒ“</h1>
                <p class="text-[9px] font-bold text-emerald-500 uppercase tracking-widest">Hibiki Partner Project</p>
            </div>
            <div class="flex gap-3">
                <span class="text-xl">ğŸ“Š</span>
                <span class="text-xl">ğŸ””</span>
            </div>
        </div>
    </header>

    <main class="max-w-md mx-auto px-4 py-6 space-y-6">
        
        <div class="relative w-full h-[420px] rounded-[2.5rem] overflow-hidden shadow-2xl bg-white border-4 border-white fade-in">
            <div class="absolute inset-0 bg-gradient-to-t from-emerald-50/50 to-transparent"></div>
            
            <img id="hibiki-avatar" src="./879.jpg" alt="éŸ¿" class="w-full h-full object-contain object-bottom hibiki-hero relative z-10">
            
            <div class="absolute top-6 left-6 right-6 z-20">
                <div class="bg-white/95 shadow-xl p-4 rounded-2xl border border-emerald-50">
                    <p id="chat-bubble" class="text-xs font-bold text-slate-700 leading-relaxed text-center">ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‘ãƒˆãƒ­ãƒ¼ãƒ«ä¸­ã ã‚ˆã€ç›¸æ£’ï¼</p>
                </div>
            </div>

            <div id="recipe-area" class="absolute bottom-6 left-6 right-6 z-20 hidden">
                <button id="recipe-go" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-black py-4 rounded-2xl shadow-lg transform active:scale-95 transition-all flex items-center justify-center gap-2">
                    ğŸ³ <span class="text-sm">ä»Šæ—¥ã®æ¿€å®‰é£Ÿæã§ãƒ¬ã‚·ãƒ”æ¤œç´¢ï¼</span>
                </button>
            </div>
        </div>

        <section class="space-y-4">
            <div class="flex justify-between items-end px-2">
                <h2 class="text-lg font-black text-slate-800">æœ¬æ—¥ã®ç‰¹å£²ãƒªã‚¹ãƒˆ</h2>
                <p id="last-update" class="text-[10px] text-slate-400 font-mono"></p>
            </div>
            
            <div id="price-container" class="space-y-3">
                <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 text-center text-slate-400 text-xs">
                    ãƒ‘ãƒˆãƒ­ãƒ¼ãƒ«çµæœã‚’ç¢ºèªã—ã¦ã„ã¾ã™...
                </div>
            </div>
        </section>
    </main>

    <div class="fixed bottom-6 left-6 right-6 max-w-md mx-auto z-50">
        <nav class="bg-slate-900/95 backdrop-blur-xl rounded-[2rem] p-3 shadow-2xl border border-white/10 flex justify-around items-center">
            <button class="flex flex-col items-center gap-1 text-emerald-400 transition-colors">
                <span class="text-2xl">ğŸ </span>
                <span class="text-[9px] font-bold">ãƒ›ãƒ¼ãƒ </span>
            </button>
            <button class="flex flex-col items-center gap-1 text-slate-400">
                <span class="text-2xl">ğŸ”</span>
                <span class="text-[9px] font-bold">æ¢ã™</span>
            </button>
            <button class="flex flex-col items-center gap-1 text-slate-400">
                <span class="text-2xl">ğŸ“‹</span>
                <span class="text-[9px] font-bold">å±¥æ­´</span>
            </button>
            <button class="flex flex-col items-center gap-1 text-slate-400">
                <span class="text-2xl">ğŸ‘¤</span>
                <span class="text-[9px] font-bold">ãƒã‚¤</span>
            </button>
        </nav>
    </div>

    <script>
        const CSV_FILE = "./supermarket_prices.csv";
        let topFood = "";

        function boot() {
            const today = new Date();
            const mon = today.getMonth() + 1;
            const date = today.getDate();
            const avatar = document.getElementById('hibiki-avatar');
            const chat = document.getElementById('chat-bubble');
            const snow = document.getElementById('snow-field');

            let img = "879.jpg"; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
            let msg = "ç›¸æ£’ã€ä»Šæ—¥ã®é™å²¡ã®æœ€å®‰å€¤ã‚’ã¾ã¨ã‚ãŸã‚ˆï¼";
            let winter = (mon === 12 || mon === 1 || mon === 2);

            // ğŸ ãŠæ­£æœˆç‰¹åˆ¥åˆ¤å®š (1/1ã€œ1/3)
            if (mon === 1 && date <= 3) {
                img = "avatar_newyear.png"; //
                msg = "ã‚ã‘ãŠã‚ï¼ä»Šå¹´ã‚‚ãŠå¾—ãªæƒ…å ±ã‚’ã‚¬ãƒ³ã‚¬ãƒ³å±Šã‘ã‚‹ã­â™ª";
            } else if (winter) {
                msg = "å¤–ã¯å¯’ã„ã­ï¼ãŠé‹ã®ææ–™ã€å®‰ã„ã®æ¢ã—ã¦ãŠã„ãŸã‚ˆã€‚";
            }

            avatar.src = "./" + img;
            chat.innerText = msg;

            // â„ï¸ é›ªã®ç”Ÿæˆ
            if (winter) {
                snow.style.display = "block";
                for (let i = 0; i < 30; i++) {
                    const s = document.createElement('div');
                    s.className = 'snowflake';
                    s.style.left = Math.random() * 100 + '%';
                    const sz = Math.random() * 5 + 2 + 'px';
                    s.style.width = sz; s.style.height = sz;
                    s.style.animationDuration = Math.random() * 6 + 4 + 's';
                    s.style.animationDelay = Math.random() * 4 + 's';
                    snow.appendChild(s);
                }
            }
            avatar.onerror = () => { avatar.src = "./879.jpg"; };
        }

        async function refreshData() {
            try {
                const res = await fetch(CSV_FILE + "?nocache=" + Date.now());
                if (!res.ok) throw new Error();
                const text = await res.text();
                const lines = text.split('\n').filter(l => l.trim()).slice(1);
                const container = document.getElementById('price-container');
                
                if (lines.length > 0) {
                    const first = lines[0].split(',');
                    topFood = first[0];
                    document.getElementById('recipe-area').classList.remove('hidden');
                    document.getElementById('last-update').innerText = "Last Update: " + (first[4] || "Today");
                }

                container.innerHTML = lines.map(line => {
                    const c = line.split(',');
                    return `
                        <div class="bg-white p-4 rounded-3xl shadow-sm border border-slate-50 flex justify-between items-center transform transition-active active:scale-[0.98]">
                            <div class="flex gap-4 items-center">
                                <div class="w-10 h-10 bg-emerald-50 rounded-2xl flex items-center justify-center text-xl">ğŸ›’</div>
                                <div>
                                    <h3 class="font-black text-slate-700 text-sm">${c[0]||"-"}</h3>
                                    <p class="text-[10px] text-slate-400 font-bold">ğŸ“ ${c[2]||"-"}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="text-lg font-black text-red-500">Â¥${c[1]||"-"}</span>
                            </div>
                        </div>`;
                }).join('');
            } catch (e) {
                document.getElementById('price-container').innerHTML = 
                    '<div class="py-10 text-center text-slate-400 text-xs">ãƒ‘ãƒˆãƒ­ãƒ¼ãƒ«æ©ŸãŒãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­ã¿ãŸã„ï¼<br>å°‘ã—å¾…ã£ã¦ã‹ã‚‰å†èª­ã¿è¾¼ã¿ã—ã¦ã¿ã¦ã­ã€‚</div>';
            }
        }

        document.getElementById('recipe-go').onclick = () => {
            if (topFood) window.open(`https://www.google.com/search?q=${encodeURIComponent(topFood + " ãƒ¬ã‚·ãƒ”")}`, '_blank');
        };

        boot();
        refreshData();
    </script>
</body>
</html>
