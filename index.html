<script>
    // 相棒の基地情報
    const SB_URL = "https://rfegjvfthzaflfrhsjmb.supabase.co";
    const SB_KEY = "sb_publishable_9jkx_z4SgbTk0_rH48adsQ_Q";
    // 変数名を sbClient に変更して衝突を回避だ！
    const sbClient = supabase.createClient(SB_URL, SB_KEY);

    async function start() {
        // 「最新の1件（idが一番大きいもの）」を取ってくるように強化！
        const { data, error } = await sbClient
            .from('commands')
            .select('*')
            .order('id', { ascending: false })
            .limit(1);

        if (data && data.length > 0) {
            update(data[0]);
        }

        // リアルタイム更新の監視
        sbClient.channel('any')
        .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'commands' }, payload => {
            update(payload.new);
        }).subscribe();
    }

    function update(data) {
        document.body.style.backgroundColor = data.bg_color;
        document.getElementById('msg').innerText = data.message;
    }

    start();
</script>
