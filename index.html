<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é™å²¡æœ€å®‰å€¤ãƒŠãƒ“ | éŸ¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes breathe { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-8px); } }
        .hibiki-alive { animation: breathe 3s ease-in-out infinite; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.1)); }
        @keyframes snowfall { 0% { transform: translateY(-10vh) translateX(0); opacity: 1; } 100% { transform: translateY(100vh) translateX(20px); opacity: 0.4; } }
        .snow-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50; }
        .snowflake { position: absolute; top: -10px; background-color: white; border-radius: 50%; opacity: 0.8; animation: snowfall linear infinite; }
    </style>
</head>
<body class="bg-emerald-50 text-gray-800">
    <div id="snow-box" class="snow-container" style="display:none;"></div>

    <div class="min-h-screen p-4 flex flex-col items-center relative overflow-hidden">
        <header class="text-center mb-6 z-10">
            <h1 class="text-2xl font-black text-green-700 tracking-tighter">é™å²¡æœ€å®‰å€¤ãƒŠãƒ“</h1>
            <p class="text-[10px] text-green-600 font-bold uppercase tracking-widest">Fresh & Best Recipe Guide</p>
        </header>

        <div class="mb-4 text-center z-10 flex flex-col items-center">
            <div class="w-24 h-24 rounded-full bg-white p-1 shadow-md border-2 border-green-200 overflow-hidden mb-2">
                <img id="avatar-img" src="" alt="éŸ¿" class="w-full h-full object-cover hibiki-alive">
            </div>
            <div class="bg-white py-1.5 px-5 rounded-full shadow-sm border border-green-100">
                <p id="greeting-text" class="text-xs font-bold text-green-800">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </div>

        <div id="recipe-section" class="mb-6 z-10 w-full max-w-md hidden">
            <button id="recipe-btn" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 rounded-xl shadow-lg transition-transform active:scale-95 flex items-center justify-center gap-2">
                ğŸ³ <span>ä»Šæ—¥ã®æ¿€å®‰é£Ÿæã§ãƒ¬ã‚·ãƒ”ã‚’æ¤œç´¢ï¼</span>
            </button>
        </div>

        <div class="w-full max-w-md bg-white rounded-2xl shadow-xl border-b-4 border-green-200 overflow-hidden z-10">
            <div class="bg-green-600 p-3 flex justify-between items-center">
                <h2 class="text-white text-sm font-bold">æœ¬æ—¥ã®ã‚¤ãƒã‚ªã‚·æœ€å®‰å€¤</h2>
                <span id="update-date" class="text-[10px] text-green-100"></span>
            </div>
            <table class="w-full text-left">
                <thead class="bg-green-50">
                    <tr>
                        <th class="p-3 text-xs font-bold text-green-700">å•†å“å</th>
                        <th class="p-3 text-xs font-bold text-green-700 text-center">ä¾¡æ ¼</th>
                        <th class="p-3 text-xs font-bold text-green-700">åº—èˆ—</th>
                    </tr>
                </thead>
                <tbody id="price-table" class="divide-y divide-green-50">
                    <tr><td colspan="3" class="p-10 text-center text-gray-400 text-xs">æƒ…å ±ã‚’ãƒ‘ãƒˆãƒ­ãƒ¼ãƒ«ä¸­...</td></tr>
                </tbody>
            </table>
        </div>

        <footer class="mt-8 text-[9px] text-green-400 font-bold uppercase">Â© 2026 Shizuoka Saiyasune Navi</footer>
    </div>

    <script>
        const BASE_URL = `https://raw.githubusercontent.com/Yoshif31-lang/shizuoka-saiyasune-app/main/`;
        let firstItem = ""; // ãƒ¬ã‚·ãƒ”æ¤œç´¢ç”¨ã®é£Ÿæå

        function initApp() {
            const now = new Date();
            const month = now.getMonth() + 1;
            const date = now.getDate();
            const avatarImg = document.getElementById('avatar-img');
            const greeting = document.getElementById('greeting-text');
            const snowBox = document.getElementById('snow-box');

            let imgName = "1766939160101.png"; //
            let showSnow = (month === 12 || month === 1 || month === 2);
            let msg = "éŸ¿ã ã‚ˆï¼é™å²¡ã®å®‰å€¤ã¯ä»»ã›ã¦â™ª";

            if (month === 1 && date <= 3) {
                imgName = "avatar_newyear.png"; //
                msg = "ã‚ã‘ãŠã‚ï¼ä»Šå¹´ã‚‚ãŠå¾—ã‚’æ¢ã™ã‚ˆâ™ª";
            } else if (showSnow) {
                msg = "å¯’ã„ã­ï¼ãŠé‹ã®ææ–™ã¨ã‹ã©ã†ï¼Ÿ";
            }

            avatarImg.src = BASE_URL + imgName;
            greeting.innerText = msg;
            if (showSnow) {
                snowBox.style.display = "block";
                for (let i = 0; i < 20; i++) {
                    const flake = document.createElement('div');
                    flake.className = 'snowflake';
                    flake.style.left = Math.random() * 100 + '%';
                    const size = Math.random() * 5 + 2 + 'px';
                    flake.style.width = size; flake.style.height = size;
                    flake.style.animationDuration = Math.random() * 5 + 5 + 's';
                    flake.style.animationDelay = Math.random() * 5 + 's';
                    snowBox.appendChild(flake);
                }
            }
            avatarImg.onerror = () => { avatarImg.src = BASE_URL + "1766939160101.png"; };
        }

        async function fetchPrices() {
            try {
                // ã«åŸºã¥ãCSVå–å¾—
                const response = await fetch(BASE_URL + 'supermarket_prices.csv');
                if (!response.ok) throw new Error();
                const data = await response.text();
                const rows = data.split('\n').filter(r => r.trim()).slice(0, 15);
                const tableBody = document.getElementById('price-table');
                
                if (rows.length > 0) {
                    const cols = rows[0].split(',');
                    firstItem = cols[0]; // æœ€åˆã®é£Ÿæã‚’ãƒ¬ã‚·ãƒ”æ¤œç´¢ã«ä½¿ã†
                    document.getElementById('recipe-section').classList.remove('hidden');
                    document.getElementById('update-date').innerText = cols[4] || "";
                }

                tableBody.innerHTML = rows.map(row => {
                    const c = row.split(',');
                    return `<tr class="hover:bg-green-50/50"><td class="p-3 text-xs font-bold text-gray-700">${c[0]||"-"}</td><td class="p-3 text-sm font-black text-red-500 text-center">Â¥${c[1]||"-"}</td><td class="p-3 text-[10px] text-gray-500">${c[2]||"-"}</td></tr>`;
                }).join('');
            } catch (e) {
                document.getElementById('price-table').innerHTML = '<tr><td colspan="3" class="p-10 text-center text-gray-400 text-xs">ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚’ãŠæ¥½ã—ã¿ã«ï¼</td></tr>';
            }
        }

        // ãƒ¬ã‚·ãƒ”æ¤œç´¢ãƒœã‚¿ãƒ³ã®å‹•ä½œ
        document.getElementById('recipe-btn').addEventListener('click', () => {
            if (firstItem) {
                const query = encodeURIComponent(firstItem + " ãƒ¬ã‚·ãƒ”");
                window.open(`https://www.google.com/search?q=${query}`, '_blank');
            }
        });

        initApp();
        fetchPrices();
    </script>
</body>
</html>
